<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Members</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700;800&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:Kanit;background:#070710;color:#fff}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{margin:0 0 10px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    input,select{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#fff}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px;margin-top:12px}
    .card{display:flex;gap:10px;align-items:center;padding:12px;border-radius:16px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05)}
    .av{width:54px;height:54px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.25);flex:0 0 auto}
    .av img{width:100%;height:100%;object-fit:cover}
    .name{font-weight:800}
    .meta{opacity:.7;font-size:12px;margin-top:2px;word-break:break-all}
    a{color:#9bb2ff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Members</h1>
    <div class="bar">
      <input id="q" placeholder="ค้นหา..." />
      <select id="role">
        <option value="">ทุกบทบาท</option>
        <option>Founder</option><option>Leader</option><option>Member</option><option>Partner</option>
      </select>
      <button id="goAdmin">ไป /admin</button>
    </div>
    <div id="grid" class="grid"></div>
  </div>

<script>
const API_BASE = "https://YOUR-WORKER.workers.dev"; // ✅ แก้ตรงนี้

async function load(){
  const q = document.getElementById("q").value.trim();
  const role = document.getElementById("role").value;
  const url = new URL(API_BASE + "/api/members");
  if(q) url.searchParams.set("q", q);
  if(role) url.searchParams.set("role", role);

  const res = await fetch(url.toString());
  const data = await res.json();
  const list = data.members || [];

  document.getElementById("grid").innerHTML = list.map(m => `
    <div class="card">
      <div class="av"><img src="${m.image_url || "https://via.placeholder.com/120"}"></div>
      <div>
        <div class="name">${m.name || ""}</div>
        <div class="meta">${m.role || ""} • rank ${m.rank_order ?? 999}</div>
        <div class="meta">${m.social_link ? `<a href="${m.social_link}" target="_blank">${m.social_link}</a>` : ""}</div>
      </div>
    </div>
  `).join("");
}

document.getElementById("q").addEventListener("input", load);
document.getElementById("role").addEventListener("change", load);
document.getElementById("goAdmin").addEventListener("click", ()=>location.href="/admin/");
load();
</script>
</body>
</html>
